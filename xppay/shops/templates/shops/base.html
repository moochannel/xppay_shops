{% load static %}
{% load shop_extras %}
<!DOCTYPE html>
<html>

  <head>
    <title>{% block title %}ページタイトル{% endblock %} - XPpay SHOPS</title>
    {% include 'material/includes/material_css.html' %}
    <script src="{% static 'material/js/jquery.js' %}"></script>
    <link rel="icon" href="{% static 'images/favicon.ico' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    {% block headcss %}{% endblock %}
  </head>

  <body>
    <ul id="slide-out" class="sidenav">
      <li>
        <div class="user-view">
          <div class="background">
            <img src="{% static 'shops/xp-man-1.png' %}" style="width: 100%;" class="blue-grey darken-1">
          </div>
          {% if user.avatar_hash %}
          <img class="circle" src="https://cdn.discordapp.com/avatars/{{ user.discord_id }}/{{ user.avatar_hash }}.png">
          {% endif %}
          <span class="white-text name">{{ user.name }}</span>
          <span class="white-text email">{{ user.email }}</span>
        </div>
      </li>
      <li><a href="{% url 'shops:shop_list' %}">店舗</a></li>
      {% if user.is_authenticated %}
      {% if perms.shops.can_approve %}
      <li><a href="{% url 'shops:approve_waiting' %}">承認待ち{% unapproved_shops_badge %}</a></li>
      {% endif %}
      <li><div class="divider"></div></li>
      <li><a href="{% url 'accounts:profile_edit' %}">プロフィール編集</a></li>
      <li><a href="{% url 'accounts:logout' %}">ログアウト</a></li>
      {% else %}
      <li><a href="{% url 'social:begin' 'discord' %}?next={{ request.path }}">Login with Discord</a></li>
      {% endif %}
    </ul>

    <ul id="user_menu" class="dropdown-content">
      <li><a href="{% url 'accounts:profile_edit' %}" class="disabled">プロフィール編集</a></li>
      <li class="divider"></li>
      <li><a href="{% url 'accounts:logout' %}">ログアウト</a></li>
    </ul>

    <header>
      <nav class="nav-extended">
        <div class="nav-wrapper">
          <div class="container">
            <a href="#" data-target="slide-out" class="sidenav-trigger show-on-med-and-down"><i class="material-icons">menu</i></a>
            <a href="{% url 'shops:shop_list' %}" class="brand-logo">XPpay SHOPS</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
              <li>
                <a href="{% url 'shops:shop_list' %}">店舗</a>
              </li>
              {% if user.is_authenticated %}
              {% if perms.shops.can_approve %}
              <li>
                <a href="{% url 'shops:approve_waiting' %}">承認待ち{% unapproved_shops_badge %}</a>
              </li>
              {% endif %}
              <li>
                <a href="#!" class="dropdown-trigger" data-target="user_menu">
                  {% if user.avatar_hash %}
                  <img class="circle" src="https://cdn.discordapp.com/avatars/{{ user.discord_id }}/{{ user.avatar_hash }}.png" style="width: 2.5rem; margin-right: 0.5rem; vertical-align: middle;">
                  {% endif %}
                  <div class="right">{{ user.name }}<i class="material-icons right">arrow_drop_down</i></div>
                </a>
              </li>
              {% else %}
              <li>
                <a href="{% url 'social:begin' 'discord' %}?next={{ request.path }}">Login with Discord</a>
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
        <div class="nav-wrapper hide-on-med-and-down">
          <div class="container">
            <div class="col s12">
              <a href="{% url 'shops:shop_list' %}" class="breadcrumb">店舗一覧</a>
              {% block breadcrumbs %}{% endblock %}
            </div>
          </div>
        </div>
      </nav>
    </header>
    <main id="content" class="container">
      {% block content %}{% endblock %}
    </main>
    <footer>
      {% block footer %}{% endblock %}
    </footer>

    {% if messages %}
    <ul class="server_messages hide">
      {% for message in messages %}
      <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% include 'material/includes/material_js.html' %}
    <script>
      var sidenav_elem = document.querySelector('.sidenav');
      var instance = M.Sidenav.init(sidenav_elem, {
        draggable: true,
      });
      var fab_elem = document.querySelector('.fixed-action-btn');
      if (fab_elem) {
        var fab_instance = M.FloatingActionButton.init(fab_elem);
      }
      var dropdown_menu_elem = document.querySelector('.dropdown-trigger');
      if (dropdown_menu_elem) {
        var dropdown_instance = M.Dropdown.init(dropdown_menu_elem);
      }

      var messages_elem = document.querySelectorAll('.server_messages > li');
      if (messages_elem.length > 0) {
        for (var message_elem of messages_elem) {
          M.toast({html: message_elem.textContent.trim()});
        }
      }
    </script>
    {% block foot_layer2_js %}{% endblock %}
    {% block footjs %}{% endblock %}
  </body>
</html>
